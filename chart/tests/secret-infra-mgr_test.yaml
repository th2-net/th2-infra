suite: test infra-mgr-secret
values:
  - ../values.yaml
templates:
  - configs/secret-infra-mgr.yaml
tests:
  - it: Demo
    asserts:
      - hasDocuments:
          count: 0
  - it: Name
    set:
      infraMgr:
        git:
          secretName: "infra-mgr"
    asserts:
      - equal:
          path: metadata.name
          value: infra-mgr
  - it: https
    set:
      infraMgr:
        git:
          httpAuthUsername: "th2"
          httpAuthPassword: "password"
          privateKey: "key"
          repository: https://github.com/th2-net/th2-demo-configuration.git
          secretName: "infra-mgr"
    asserts:
      - isNull:
          path: data.id_rsa
      - equal:
          path: data.httpAuthUsername
          value: dGgy
      - equal:
          path: data.httpAuthPassword
          value: cGFzc3dvcmQ=
  - it: ssh
    set:
      infraMgr:
        git:
          httpAuthUsername: "th2"
          httpAuthPassword: "password"
          privateKey: "key"
          secretName: "infra-mgr"
    asserts:
      - equal:
          path: data.id_rsa
          value: key
      - isNull:
          path: data.httpAuthUsername
      - isNull:
          path: data.httpAuthPassword